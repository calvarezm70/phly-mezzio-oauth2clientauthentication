<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Configuration - phly</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Configuration", url: "#_top", children: [
              {title: "Global configuration", url: "#global-configuration" },
              {title: "Local/Environment-specific configuration", url: "#localenvironment-specific-configuration" },
              {title: "Pipeline configuration", url: "#pipeline-configuration" },
              {title: "Route configuration", url: "#route-configuration" },
          ]},
        ];

    </script>
    <script src="../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../debug/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../debug/" class="btn btn-xs btn-link">
        Debug Provider
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../intro/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../intro/" class="btn btn-xs btn-link">
        Introduction
      </a>
    </div>
    
  </div>

    

    <h1 id="configuration">Configuration</h1>
<p>In order to use this authentication adapter, you will need to provide
configuration for the OAuth2 providers you plan to use.</p>
<p>Examples are provided in the <code>config/</code> directory of this component, and repeated
here for purposes of documentation:</p>
<h2 id="global-configuration">Global configuration</h2>
<p>This is configuration that should be present no matter what environment you are
in, and it covers the base path for the OAuth2 client callbacks and debug
provider URIs.</p>
<pre><code class="php">// e.g. config/autoload/oauth2-client.global.php:

return [
    'oauth2clientauthentication' =&gt; [
        // Configure the base path for all OAuth2 client callbacks. By default,
        // this is &quot;/auth&quot;.
        // 'auth_path' =&gt; '/auth',

        // Configure the production and debug routes for OAuth2 client callbacks
        // if desired. These strings will be relative to the 'auth_path' config
        // as specified above. Provider names in the regex should match the keys 
        // associated with enabled providers in configuration. The &quot;custom&quot; string 
        // is just an example of a provider key named &quot;custom&quot; described below.
        'routes' =&gt; [
            // Production path.
            // 'production' =&gt; '/{provider:facebook|github|google|instagram|linkedin|custom}[/oauth2callback]',

            // Debug path.
            // 'debug' =&gt; '/{provider:debug|facebook|github|google|instagram|linkedin|custom}[/oauth2callback]',
        ],
    ],
];
</code></pre>

<h2 id="localenvironment-specific-configuration">Local/Environment-specific configuration</h2>
<p>This is configuration for the providers you wish to enable. You will need to
review the [league/oauth2-client providers documentation](http://oauth2-client.thephpleague.com/providers/league/
for links to both full configuration documentation, as well as resources on how
to obtain the various client identifiers and secrets you will need to use.</p>
<p>Each provider you define needs at least the provider key with the client class name and 
the options key with an array which is passed to the client constructor.</p>
<p>This information should <em>not</em> be shipped directly in your repository, but rather
included as part of your application environment.</p>
<pre><code class="php">// e.g. config/autoload/oauth2-client.local.php:

return [
    'oauth2clientauthentication' =&gt; [
        'debug' =&gt; [
            // Provider key must be present for factory creation.
            'provider' =&gt; Debug\DebugProvider::class,
            'options' =&gt; [
                // Provide this if you have provided an alternate route path via
                // the oauth2clientauthentication.routes.debug key:
                // 'callback_uri_template' =&gt; '/alternate/debug/callback?code=%s&amp;state=%s',

                // Provide this if you want to use an alternate path for the OAuth2
                // &quot;server&quot; authorization:
                // 'authorization_url' =&gt; '/alternate/debug/authorization',
            ]
        ],

        // Facebook
        // 'facebook' =&gt; [
        //     'provider' =&gt; Provider\Facebook::class,
        //     'options' =&gt; [
        //         'clientId' =&gt; '{facebook-app-id}',
        //         'clientSecret' =&gt; '{facebook-app-secret}',
        //         'redirectUri' =&gt; '', // based on the auth_path + production route; must be fully qualifed
        //         'graphApiVersion' =&gt; 'v2.10',
        //     ],
        // ],

        // GitHub
        // 'github' =&gt; [
        //     'provider' =&gt; Provider\Github::class,
        //     'options' =&gt; [
        //         'clientId' =&gt; '{github-client-id}',
        //         'clientSecret' =&gt; '{github-client-secret}',
        //         'redirectUri' =&gt; '', // based on the auth_path + production route; must be fully qualifed
        //     ],
        // ],

        // Google
        // 'google' =&gt; [
        //     'provider' =&gt; Provider\Google::class,
        //     'options' =&gt; [
        //         'clientId' =&gt; '{google-client-id}',
        //         'clientSecret' =&gt; '{google-client-secret}',
        //         'redirectUri' =&gt; '', // based on the auth_path + production route; must be fully qualifed
        //         'hostedDomain' =&gt; '', // scheme + domain of your app
        //     ],
        // ],

        // Instagram
        // 'instagram' =&gt; [
        //     'provider' =&gt; Provider\Instagram::class,
        //     'options' =&gt; [
        //        'clientId' =&gt; '{instagram-client-id}',
        //        'clientSecret' =&gt; '{instagram-client-secret}',
        //        'redirectUri' =&gt; '', // based on the auth_path + production route; must be fully qualifed
        //        'host' =&gt; 'https://api.instagram.com', // Optional; this is the default
        //     ],
        // ],

        // LinkedIn
        // 'linkedin' =&gt; [
        //     'provider' =&gt; Provider\LinkedIn::class,
        //     'options' =&gt; [
        //         'clientId' =&gt; '{linkedin-client-id}',
        //         'clientSecret' =&gt; '{linkedin-client-secret}',
        //         'redirectUri' =&gt; '', // based on the auth_path + production route; must be fully qualifed
        //     ],
        // ],

        // Customized
        // It's possible to configure any provider that extend the League AbstractProvider, including custom 
        // implementations or extensions. This example uses GenericProvider which can be used with any OAuth 
        // 2.0 Server that uses Bearer tokens.
        // 'custom' =&gt; [
        //    'provider' =&gt; Provider\GenericProvider::class,
        //    'options' =&gt; [
        //        'clientId' =&gt; '',
        //        'clientSecret' =&gt; '',
        //        'redirectUri' =&gt; '',
        //        'urlAuthorize' =&gt; '',
        //        'urlAccessToken' =&gt; '',
        //        'urlResourceOwnerDetails' =&gt; '',
        //    ],
        // ],
    ],
    'dependencies' =&gt; [
        'factories' =&gt; [
            // Enable this when in debug mode:
            // Debug\DebugProviderMiddleware::class =&gt; Debug\DebugProviderMiddlewareFactory::class,
        ],
    ],
];
</code></pre>

<h2 id="pipeline-configuration">Pipeline configuration</h2>
<p>The various callbacks operate under a base path as specified by the
<code>oauth2clientauthentication.auth_path</code> configuration, which defaults to <code>/auth</code>.
You will need to pipe the <code>Phly\Expressive\OAuth2ClientAuthentication\OAuth2CallbackMiddleware</code>
service to that path:</p>
<pre><code class="php">// In config/pipeline.php:

use Phly\Expressive\OAuth2ClientAuthentication\OAuth2CallbackMiddleware;

$app-&gt;pipe('/auth', OAuth2CallbackMiddleware::class);
</code></pre>

<p>@todo Detail how to pipe the callback middleware when using other middleware frameworks.</p>
<h2 id="route-configuration">Route configuration</h2>
<p>Once the above is complete, you can add
<code>Zend\Expressive\Authentication\AuthenticationMiddleware</code> to your route-specific
pipelines. You will also need to pipe
<code>Zend\Expressive\Session\SessionMiddleware</code> in these pipelines as this adapter
persists user information within the session.</p>
<p>As an example:</p>
<pre><code class="php">// In config/routes.php

use Zend\Expressive\Authentication\AuthenticationMiddleware;
use Zend\Expressive\Session\SessionMiddleware;

$app-&gt;post('/api/books', [
    SessionMiddleware::class,
    AuthenticationMiddleware::class,
    CreateBookHandler::class,
]);
</code></pre>

<blockquote>
<h3 id="create-a-delegator-factory">Create a delegator factory</h3>
<p>You may want to consider creating a delegator factory for registering these
two middleware in a pipeline with any handler. As an example:</p>
<p><code>php
function (ContainerInterface $container, $serviceName, callable $callback)
{
    $pipeline = new MiddlewarePipe();
    $pipeline-&gt;pipe($container-&gt;get(SessionMiddleware::class));
    $pipeline-&gt;pipe($container-&gt;get(AuthenticationMiddleware::class));
    $pipeline-&gt;pipe($callback());
    return $pipeline;
}</code></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../debug/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../debug/" class="btn btn-xs btn-link">
        Debug Provider
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../intro/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../intro/" class="btn btn-xs btn-link">
        Introduction
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/phly/phly-expressive-oauth2clientauthentication/edit/master/docs/config.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p><p>Copyright (c) 2019 <a href="https://mwop.net">Matthew Weier O&#39;Phinney</a></p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>